{
  "comments": [
    {
      "key": {
        "uuid": "e0120a1e_94b35323",
        "filename": "apps/weaver/card/src/com/android/weaver/Weaver.java",
        "patchSetId": 2
      },
      "lineNbr": 31,
      "author": {
        "id": 1022354
      },
      "writtenOn": "2017-04-17T13:11:44Z",
      "side": 1,
      "message": "I assume you don\u0027t need any LSBackup stuff here? E.g., we don\u0027t expect to preserve data on a applet backup?",
      "range": {
        "startLine": 31,
        "startChar": 65,
        "endLine": 31,
        "endChar": 71
      },
      "revId": "49e76723588baee75d4f16b0f71f0fd6fd737294",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "35087fcc_e582a1d3",
        "filename": "apps/weaver/card/src/com/android/weaver/Weaver.java",
        "patchSetId": 2
      },
      "lineNbr": 31,
      "author": {
        "id": 1139038
      },
      "writtenOn": "2017-04-17T14:01:16Z",
      "side": 1,
      "message": "I\u0027m don\u0027t know what a backup involves or when it happens. If this applet loses its data then the credential will no longer work so you won\u0027t be able to unlock. Does it sound like we need to handle backup here?",
      "parentUuid": "e0120a1e_94b35323",
      "range": {
        "startLine": 31,
        "startChar": 65,
        "endLine": 31,
        "endChar": 71
      },
      "revId": "49e76723588baee75d4f16b0f71f0fd6fd737294",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "871eb1a0_eb9acd08",
        "filename": "apps/weaver/card/src/com/android/weaver/Weaver.java",
        "patchSetId": 2
      },
      "lineNbr": 31,
      "author": {
        "id": 1022354
      },
      "writtenOn": "2017-04-17T15:38:14Z",
      "side": 1,
      "message": "I think it is a non-goal (so let\u0027s skip it), but paulcrowley@ should answer definitively :)\n\n(FWIW, I have support in the avb_storage app, though I have not had the chance to _exercise_ it yet without LS tools.)",
      "parentUuid": "35087fcc_e582a1d3",
      "range": {
        "startLine": 31,
        "startChar": 65,
        "endLine": 31,
        "endChar": 71
      },
      "revId": "49e76723588baee75d4f16b0f71f0fd6fd737294",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "73f99b97_935d20b0",
        "filename": "apps/weaver/card/src/com/android/weaver/Weaver.java",
        "patchSetId": 2
      },
      "lineNbr": 45,
      "author": {
        "id": 1022354
      },
      "writtenOn": "2017-04-17T13:11:44Z",
      "side": 1,
      "message": "Is there any interest in the data wipe sio coming out of the avb_storage applet?  It\u0027s not required, but it is potentially a nice enough way to trigger factory-reset via one applet interface. Same with checking on the gpio (which, of course, is difficult to test right now).",
      "range": {
        "startLine": 45,
        "startChar": 34,
        "endLine": 45,
        "endChar": 67
      },
      "revId": "49e76723588baee75d4f16b0f71f0fd6fd737294",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6714d28b_4f3c7fc0",
        "filename": "apps/weaver/card/src/com/android/weaver/Weaver.java",
        "patchSetId": 2
      },
      "lineNbr": 45,
      "author": {
        "id": 1139038
      },
      "writtenOn": "2017-04-17T14:01:16Z",
      "side": 1,
      "message": "You mean so you can request that this applet deletes it\u0027s data?\n\nThat isn\u0027t necessary as the keys should be high enough entropy that they can sit around safely. But it would be cleaner and also safer to hook that up. I had the ERASE_ALL command for clearing out but didn\u0027t know what would call it. Looks like you\u0027re saying it would be the avb_storage applet so there is no need to the APDU command.",
      "parentUuid": "73f99b97_935d20b0",
      "range": {
        "startLine": 45,
        "startChar": 34,
        "endLine": 45,
        "endChar": 67
      },
      "revId": "49e76723588baee75d4f16b0f71f0fd6fd737294",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "38655f71_58007ce7",
        "filename": "apps/weaver/card/src/com/android/weaver/Weaver.java",
        "patchSetId": 2
      },
      "lineNbr": 45,
      "author": {
        "id": 1022354
      },
      "writtenOn": "2017-04-17T15:38:14Z",
      "side": 1,
      "message": "Yeah - the flow is\n- Grab the globalstate.OwnerInterface from the avb_storage app (returns GlobalStateImpl) at creation time.\n- Call notifyOnDataClear(false) to register your AID.\n- on a getShareable call, return a globalstate.CallbackInterface which is how notification comes in (CallbackInterface.clearData())\n- On each process(), check with the ownerInterface.dataClearNeeded() to see if there was an interrupted data clear.\n- When completed, call ownerInterface.reportDataCleared().\n\nOf course.... I just realized I did not implement a call to triggerDataClear() in avb_storage! So I need to add an APDU there. I would keep ERASE_ALL and we can cut over to unifying as needed after  since I didn\u0027t wire up the actual APDU for triggering a clear!  As is, the caller has to clear each field as they see fit on the storage app.\n\nIf you\u0027d prefer, I can wire up a FACTORY_CLEAR call as well as the necessary checks during process() to ensure that all applets _have_ completed a clear before continuing a boot.\n\nI will look at that shortly but I don\u0027t think it is a hard requirement if you have ERASE_ALL. Let\u0027s just get the key stuff down right away and go from there!",
      "parentUuid": "6714d28b_4f3c7fc0",
      "range": {
        "startLine": 45,
        "startChar": 34,
        "endLine": 45,
        "endChar": 67
      },
      "revId": "49e76723588baee75d4f16b0f71f0fd6fd737294",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a455ae9c_d75ad017",
        "filename": "apps/weaver/card/src/com/android/weaver/Weaver.java",
        "patchSetId": 2
      },
      "lineNbr": 77,
      "author": {
        "id": 1022354
      },
      "writtenOn": "2017-04-17T13:11:44Z",
      "side": 1,
      "message": "Cross-check that this is exactly the behavior you want. I ended up tweaking this slightly in https://android.googlesource.com/platform/external/libese/+/master/apps/boot/card/src/com/android/verifiedboot/storage/Storage.java",
      "range": {
        "startLine": 77,
        "startChar": 16,
        "endLine": 77,
        "endChar": 28
      },
      "revId": "49e76723588baee75d4f16b0f71f0fd6fd737294",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a0d6038c_0dd1e238",
        "filename": "apps/weaver/card/src/com/android/weaver/Weaver.java",
        "patchSetId": 2
      },
      "lineNbr": 87,
      "author": {
        "id": 1022354
      },
      "writtenOn": "2017-04-17T13:11:44Z",
      "side": 1,
      "message": "wrapping these  up in a class is nice -- thanks!",
      "range": {
        "startLine": 87,
        "startChar": 17,
        "endLine": 87,
        "endChar": 23
      },
      "revId": "49e76723588baee75d4f16b0f71f0fd6fd737294",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "61a81e77_13f396a2",
        "filename": "apps/weaver/card/src/com/android/weaver/Weaver.java",
        "patchSetId": 2
      },
      "lineNbr": 87,
      "author": {
        "id": 1139038
      },
      "writtenOn": "2017-04-17T14:01:16Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "a0d6038c_0dd1e238",
      "range": {
        "startLine": 87,
        "startChar": 17,
        "endLine": 87,
        "endChar": 23
      },
      "revId": "49e76723588baee75d4f16b0f71f0fd6fd737294",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c056f031_2aead48a",
        "filename": "apps/weaver/card/src/com/android/weaver/Weaver.java",
        "patchSetId": 2
      },
      "lineNbr": 122,
      "author": {
        "id": 1022354
      },
      "writtenOn": "2017-04-17T13:11:44Z",
      "side": 1,
      "message": "nit: Util.setShort(buffer, (short) 0, (short) 0); ?",
      "range": {
        "startLine": 122,
        "startChar": 8,
        "endLine": 122,
        "endChar": 14
      },
      "revId": "49e76723588baee75d4f16b0f71f0fd6fd737294",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "91c7da89_66ad94a5",
        "filename": "apps/weaver/card/src/com/android/weaver/Weaver.java",
        "patchSetId": 2
      },
      "lineNbr": 122,
      "author": {
        "id": 1139038
      },
      "writtenOn": "2017-04-17T14:01:16Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c056f031_2aead48a",
      "range": {
        "startLine": 122,
        "startChar": 8,
        "endLine": 122,
        "endChar": 14
      },
      "revId": "49e76723588baee75d4f16b0f71f0fd6fd737294",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f6f66010_f932da58",
        "filename": "apps/weaver/card/src/com/android/weaver/Weaver.java",
        "patchSetId": 2
      },
      "lineNbr": 234,
      "author": {
        "id": 1022354
      },
      "writtenOn": "2017-04-17T13:11:44Z",
      "side": 1,
      "message": "Is it worth noting the official endianness then?",
      "range": {
        "startLine": 234,
        "startChar": 36,
        "endLine": 234,
        "endChar": 40
      },
      "revId": "49e76723588baee75d4f16b0f71f0fd6fd737294",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1dddaf0f_b80d253b",
        "filename": "apps/weaver/card/src/com/android/weaver/core/CoreSlots.java",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 1022354
      },
      "writtenOn": "2017-04-17T13:11:44Z",
      "side": 1,
      "message": "boilerplate plz",
      "range": {
        "startLine": 1,
        "startChar": 31,
        "endLine": 1,
        "endChar": 32
      },
      "revId": "49e76723588baee75d4f16b0f71f0fd6fd737294",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "aecea477_60b594bc",
        "filename": "apps/weaver/card/src/com/android/weaver/core/CoreSlots.java",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 1139038
      },
      "writtenOn": "2017-04-17T14:01:16Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1dddaf0f_b80d253b",
      "range": {
        "startLine": 1,
        "startChar": 31,
        "endLine": 1,
        "endChar": 32
      },
      "revId": "49e76723588baee75d4f16b0f71f0fd6fd737294",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da94061d_5079bf11",
        "filename": "apps/weaver/weaver.c",
        "patchSetId": 2
      },
      "lineNbr": 50,
      "author": {
        "id": 1022354
      },
      "writtenOn": "2017-04-17T13:11:44Z",
      "side": 1,
      "message": "Guessing the applet support libs should be unified later :)",
      "range": {
        "startLine": 50,
        "startChar": 13,
        "endLine": 50,
        "endChar": 30
      },
      "revId": "49e76723588baee75d4f16b0f71f0fd6fd737294",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ef21d436_07fb8920",
        "filename": "apps/weaver/weaver.c",
        "patchSetId": 2
      },
      "lineNbr": 50,
      "author": {
        "id": 1139038
      },
      "writtenOn": "2017-04-17T14:01:16Z",
      "side": 1,
      "message": "Yeah, I\u0027m being lazy ATM, sorry.",
      "parentUuid": "da94061d_5079bf11",
      "range": {
        "startLine": 50,
        "startChar": 13,
        "endLine": 50,
        "endChar": 30
      },
      "revId": "49e76723588baee75d4f16b0f71f0fd6fd737294",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4c870a3a_ee9839f7",
        "filename": "apps/weaver/weaver.c",
        "patchSetId": 2
      },
      "lineNbr": 71,
      "author": {
        "id": 1022354
      },
      "writtenOn": "2017-04-17T13:11:44Z",
      "side": 1,
      "message": "same here -- we should probably have done a standard libese-terminal to base these on to get \"free\" channel management :)  [later]",
      "range": {
        "startLine": 71,
        "startChar": 21,
        "endLine": 71,
        "endChar": 44
      },
      "revId": "49e76723588baee75d4f16b0f71f0fd6fd737294",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2ecc8a79_1c1c151c",
        "filename": "apps/weaver/weaver.c",
        "patchSetId": 2
      },
      "lineNbr": 71,
      "author": {
        "id": 1139038
      },
      "writtenOn": "2017-04-17T14:01:16Z",
      "side": 1,
      "message": "+1, good call",
      "parentUuid": "4c870a3a_ee9839f7",
      "range": {
        "startLine": 71,
        "startChar": 21,
        "endLine": 71,
        "endChar": 44
      },
      "revId": "49e76723588baee75d4f16b0f71f0fd6fd737294",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}